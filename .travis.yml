language: minimal
sudo: required
env:
  global:
  - GRAAL_VERSION="1.0.0-rc9"
matrix:
  fast_finish: true
  include:
  - os: linux
    env:
    - GRAAL_ARCH=linux
    - NATIVE_SUFFIX=_linux
    - NATIVE_FLAGS=--static
  - os: osx
    env:
    - GRAAL_ARCH=macos
    - NATIVE_SUFFIX=_macos
    - GRAAL_HOME_SUFFIX=Contents/Home/
script:
- export GRAALVM_PKG=https://github.com/oracle/graal/releases/download/vm-${GRAAL_VERSION}/graalvm-ce-${GRAAL_VERSION}-${GRAAL_ARCH}-amd64.tar.gz
- curl --fail --silent --location --retry 3 ${GRAALVM_PKG} | gunzip | tar x -C ./
- export GRAAL_HOME=$(pwd)/graalvm-ce-${GRAAL_VERSION}/${GRAAL_HOME_SUFFIX}
- make native
deploy:
  provider: releases
  api_key:
    secure: X1IqugBzKkK+hLu39CyekUPNBR/eXs3W65Q6Wsc2xhEEJI4QPAMKQMi6qR5h0IvcwIUNZx59afRFSW3bKffwwyJhF02caHGs2ZC8/7AjcHEH5CsmJr55Ok7yeoU2tDqX5cOnGgfcZXGOlwCd1queKoT6RymcK46JVNbIWNgbWU7p5WwfXvgeKbLG+GEa4T3ugnQNKN5PhPZ99Pm6oQfJfcv6muRs1p2XfGv7FEMKa1mNwt7J/4YB300X8HSxRPMujv08at7EpDcGVcSqs1HkJEY1Ml5NtejWCDGFQ6mRCex/u5KSPvTiNz0UdoHWzwA1ZDdgd4knWQXIxhISPaA677WwX4131AIWBPVGA8OhbS8T1dgd2nm2Eqeh8dqq/79zCUkZdnTEAsznYbt+pO858BAnJwpeNMZV+zu3dsPjoJCSHK+Dm/di6C+MtQIIJcoJ0LfOqNmON1hThUMzQk0CLZv8wLUSbP3j9nqs2taVm1fgmR5Hikfm+g0bUoqv+n1YULED/Uqab+UKVZc4ba5szCDFLizsQm0wGp1lEfSlbxthDAuVlVUELKSeZs+Crg5qbqK9KRb76cW1mgNQemAZ7Otv68K9uyVFML/1LrXKCQ6s3SYoE1Y9E+XjRz2knsCh6JM7rysqhaDX2EvTeDuca1vKY4QgYhbU9AGgqXXvOfA=
  file: "./bin/jpx${NATIVE_SUFFIX}"
  on:
    repo: kppk/jpx
    tags: true
